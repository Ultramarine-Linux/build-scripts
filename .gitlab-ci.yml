image: registry.freedesktop.org/ultramarine-linux/installer-buildenv:34
services:
  - docker:dind

stages: 
  - build
  - test
  - deploy

iso-cyber:
  stage: build
  script:
    - ./build.sh cyber
  artifacts:
    paths:
    - cyber.iso

iso-cutefish:
  stage: build
  script:
    - ./build.sh cutefish
  artifacts:
    paths:
    - cutefish.iso

iso-budgie:
  stage: build
  script:
    - ./build.sh budgie
  artifacts:
    paths:
    - budgie.iso

kickstart-test:
  stage: test
  script:
    - ksflatten --config kickstarts/ultramarine-${spin}.ks --output flattened.ks && sed -i 's/\r$//' flattened.ks
    - ksvalidator flattened.ks
