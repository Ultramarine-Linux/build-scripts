# This file is a template, and might need editing before it works on your project.
# To contribute improvements to CI/CD templates, please follow the Development guide at:
# https://docs.gitlab.com/ee/development/cicd/templates.html
# This specific template is located at:
# https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Bash.gitlab-ci.yml

# See https://docs.gitlab.com/ee/ci/yaml/index.html for all available options

# you can delete this line if you're not using Docker
image: registry.gitlab.com/ultramarine-linux/installer-buildenv/lapis:latest

stages: 
  - build
  - deploy
  - test

iso-cyber:
  stage: build
  script:
      - ls -R
      - git clone https://gitlab.com/ultramarine-linux/ultramarine-kickstarts && cd ultramarine-kickstarts
      - ./build.sh cyber

upload-iso:
  stage: deploy
  dependencies:
    - iso-cyber
  script:
    - echo $PWD
    - ls -R
    - scp -i $SSH_PRIVATE_KEY ultramarine-kickstarts/Ultramarine-Linux-Live.iso cappy@lapis.cappuchino.xyz:/srv/builds/Ultramarine-Linux-build-$(date +'%M-%H-%D')/
  artifacts:
    paths:
      - ultramarine-kickstarts/Ultramarine-Linux-Live.iso

file-test:
  dependencies:
  - iso-cyber
  stage: test
  script:
  - echo $PWD
  - ls -R
  - file ultramarine-kickstarts/Ultramarine-Linux-Live.iso | grep bootable